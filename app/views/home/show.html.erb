<% if current_user %>
  <div class="page-header">
    <h1>Here is some info about you...</h1>
  </div>
  <div class="panel panel-default">
    <div class="panel-body">

      <canvas id="canvas"
      width="400"
      height="400"
      data-mouth-left-x="<%= @pic.mouth_left_x %>"
      data-mouth-right-x="<%= @pic.mouth_right_x %>"
      data-nose-y="<%= @pic.nose_y %>"
      ></canvas>
      <script type="text/javascript">

        var canvas = document.getElementById("canvas");
        ctx = canvas.getContext("2d");
        var userImage = new Image();
        userImage.crossOrigin="anonymous";

        userImage.onload = function(){
          var width = userImage.clientWidth;
          var height = userImage.clientHeight;
          var scaleWidth = 400 / width;
          var scaleHeight = 400 / height;
          ctx.scale(scaleWidth,scaleHeight);
          ctx.drawImage(userImage,0,0);
          ctx.scale(1/scaleWidth,1/scaleHeight);
          document.body.removeChild(userImage);

          var stacheImage = new Image;
          stacheImage.crossOrigin="anonymous";
          stacheImage.onload = function(){
            var width = userImage.clientWidth;
            var height = userImage.clientHeight;
            var scaleWidth = 400 / width;
            var scaleHeight = 400 / height;

            ctx.translate(gon.translate_x,gon.translate_y)
            // ctx.translate(182.60999,187.1263335) //mouthleft x times 4, nose y times 4
            // ctx.translate(188.318668,194.47666) //mouthleft x times 4, nose y times 4
            ctx.scale(scaleWidth,scaleHeight);
            var inScaleWidth = gon.inner_scale_width
            // var inScaleWidth = (47.356664 / 400 ) * 1.3//width calculations (mouth left x - mouth right x)
            ctx.scale(inScaleWidth,inScaleWidth)
            ctx.drawImage(stacheImage,0,0);
            // ctx.drawImage(stacheImage,-50,-80);
            document.body.removeChild(stacheImage)
          }
          stacheImage.src = gon.path
          document.body.appendChild(stacheImage);

        }

      // y mouthavg  48.61916675 * 4
      // width 11.839166 * 4

        userImage.src = "<%= current_user.image(:medium) %>";

        document.body.appendChild(userImage);


      </script>

      <button id="save-image" type="button" name="button">Save Stached Photo</button>
      <%= form_tag('/save_that_stache') do |f| %>

        <%= submit_tag "Save Stached Me" %>
      <% end %>
      <div class="center-block">
        <%= image_tag current_user.image.url, alt: current_user.name, class: "user_image" %>
      </div>
      <ul>
        <li><strong>Name:</strong> <%= current_user.name %></li>
        <li><strong>Provider:</strong> <%= current_user.provider %></li>
        <li><strong>uID:</strong> <%= current_user.uid %></li>
        <li><strong>Avatar URL:</strong> <%= current_user.image_url %></li>
      </ul>
    </div>
  </div>

<% end %>
